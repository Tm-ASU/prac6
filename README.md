# Отчёт по работе с SOPS и Age на Windows

## 1. Цель работы

Целью данной практической работы является изучение и практическое освоение инструментов SOPS (Secrets OPerationS) и Age, предназначенных для безопасного хранения и шифрования конфиденциальных данных. В ходе работы были выполнены установка инструментов, генерация ключей, настройка конфигурации SOPS, шифрование и расшифровка секретов. Практика выполнялась в операционной системе Windows с использованием подсистемы Windows Subsystem for Linux (WSL, Ubuntu).

## 2. Используемые инструменты и среда

Операционная система: Windows
Среда выполнения: Ubuntu 22.04 (WSL2)
Инструмент шифрования: Age
Инструмент управления секретами: SOPS
Текстовый редактор: nano
Командная оболочка: bash

## 3. Подготовка окружения

Для выполнения работы были вручную установлены утилиты **age** и **sops**, после чего их исполняемые файлы были добавлены в системную переменную `PATH`.

Корректность установки проверялась командами:

```
age --version
sops --version
```

<img width="835" height="233" alt="image" src="https://github.com/user-attachments/assets/7c43537d-72c9-4ac4-b33c-ca24be249709" />
<img width="1027" height="166" alt="image" src="https://github.com/user-attachments/assets/6883ac12-458d-47f1-9ad3-e763b7a64a23" />


## 4. Генерация ключей Age

Для шифрования данных был сгенерирован ключ Age с помощью команды:

```
age-keygen -o keys.txt
```

<img width="1211" height="91" alt="image" src="https://github.com/user-attachments/assets/bf96a5c8-1a4d-4ff1-a23e-64bc4898b540" />



В результате был создан файл `keys.txt`, содержащий приватный ключ, а также выведен публичный ключ, который используется для шифрования данных.

## 5. Настройка конфигурации SOPS

В корне проекта был создан файл конфигурации `.sops.yaml`, содержащий правила шифрования:

```
creation_rules:
  - path_regex: 'secrets\\.*\.yaml$'
    age: 'age1...'
```

Правило указывает, что все YAML-файлы в каталоге `secrets` должны автоматически шифроваться с использованием указанного публичного ключа Age. Регулярное выражение адаптировано под файловую систему Windows.

## 6. Шифрование конфиденциальных данных

Был создан файл `secrets/database.yaml`, содержащий чувствительные данные (логин и пароль).

data:
  DB_PASSWORD: supersecretpassword
  API_KEY: my_api_key_123

Шифрование выполнялось командой:

```
sops --encrypt secrets\database.yaml > secrets\database.enc.yaml
```
<img width="1161" height="164" alt="image" src="https://github.com/user-attachments/assets/4f1ae9ff-0ea6-4280-823c-9e359aa2ece0" />


В результате был получен зашифрованный файл `database.enc.yaml`, содержащий зашифрованные значения и служебный блок `sops`.

## 7. Расшифровка данных

Для расшифровки файла была предварительно задана переменная окружения, указывающая путь к приватному ключу Age:

```
$env:SOPS_AGE_KEY_FILE = "$PWD\keys.txt"
```

После этого расшифровка выполнялась командой:

```
sops --decrypt secrets\database.enc.yaml
```

<img width="1209" height="122" alt="image" src="https://github.com/user-attachments/assets/6262a006-1f73-4613-ae63-e7f79b2cd97a" />



Данные были успешно восстановлены в исходном виде.

## 8. Редактирование зашифрованных файлов

При попытке редактирования файла возникла ошибка, связанная с отсутствием редактора. Для её устранения был задан редактор через переменную окружения:

```
export EDITOR=nano
```

После этого команда:

```
SOPS_AGE_KEY_FILE=age.key sops secrets.enc.yaml
```

позволила открыть файл в расшифрованном виде, внести изменения и автоматически сохранить его в зашифрованном состоянии.

<img width="473" height="151" alt="image" src="https://github.com/user-attachments/assets/6c542519-2694-4870-aecc-5dc15f606935" />
<img width="1173" height="121" alt="image" src="https://github.com/user-attachments/assets/faa263e1-7c5a-4273-a369-7ec7411bd003" />


## 9. Вывод

В ходе выполнения практической работы были изучены и успешно применены инструменты SOPS и Age для безопасного хранения конфиденциальных данных. Использование Ubuntu в WSL позволило развернуть полноценное Linux-окружение на Windows.
Было продемонстрировано, что SOPS обеспечивает надёжное шифрование, удобное редактирование и безопасную работу с секретами, что делает данный инструмент полезным в DevOps-практиках.
Структура репозитория GitHub
Репозиторий имеет следующую структуру:
age-sops/
.sops.yaml
secrets.yaml
secrets.enc.yaml
README.md
